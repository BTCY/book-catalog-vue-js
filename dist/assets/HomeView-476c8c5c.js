import{D as R,g as F}from"./DetailsField-248e3e84.js";import{d as g,o as i,c as n,a as s,w as h,v as T,b as d,e as p,p as C,f as B,g as D,_ as N,r as E,F as m,h as _,i as c,j as u,k as L,t as v,n as M,l as U,m as V}from"./index-6670e897.js";function j(t,e){let o;return function(...a){clearTimeout(o),o=setTimeout(()=>{t.apply(this,a)},e)}}const r=t=>(C("data-v-c9f6801e"),t=t(),B(),t),A={class:"toolbar"},q={class:"search-wrap"},z={class:"params-wrap"},O={class:"param"},G=r(()=>s("label",{for:"order",class:"param-label"},"Order by",-1)),J=r(()=>s("option",{value:"newest"},"newest",-1)),K=r(()=>s("option",{value:"relevance"},"relevance",-1)),Q=[J,K],W={class:"param"},X=r(()=>s("label",{for:"maxResults",class:"param-label"},"Max results",-1)),Y=r(()=>s("option",{value:"10"},"10",-1)),Z=r(()=>s("option",{value:"20"},"20",-1)),x=r(()=>s("option",{value:"30"},"30",-1)),ee=r(()=>s("option",{value:"40"},"40",-1)),te=[Y,Z,x,ee],se={class:"param"},ae=r(()=>s("label",{for:"searchIn",class:"param-label"},"Search in",-1)),oe=D('<option value="intitle" data-v-c9f6801e>title</option><option value="inauthor" data-v-c9f6801e>author</option><option value="inpublisher" data-v-c9f6801e>publisher</option><option value="subject" data-v-c9f6801e>subject</option><option value="" data-v-c9f6801e>all</option>',5),ie=[oe],ne={class:"param"},le=r(()=>s("label",{for:"showResults",class:"param-label"},"Show results",-1)),re=r(()=>s("option",{value:"page"},"page by page",-1)),ce=r(()=>s("option",{value:"scroll"},"infinite scroll",-1)),de=[re,ce],ue={name:"BookSearchToolbar",template:"#bookSearchToolbar",computed:{keywordLocal:{get:function(){return this.keyword},set:function(t){this.$emit("searchparamchange","keyword",t)}},orderByLocal:{get:function(){return this.orderBy},set:function(t){this.$emit("searchparamchange","orderBy",t)}},maxResultsLocal:{get:function(){return this.maxResults},set:function(t){this.$emit("searchparamchange","maxResults",Number(t))}},searchInLocal:{get:function(){return this.searchIn},set:function(t){this.$emit("searchparamchange","searchIn",t)}},showResultsLocal:{get:function(){return this.showResults},set:function(t){this.$emit("searchparamchange","showResults",t)}}}},he=g({...ue,props:{keyword:{},orderBy:{},searchIn:{},showResults:{},maxResults:{}},setup(t){return(e,o)=>(i(),n("div",A,[s("div",q,[h(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>e.keywordLocal=a),autofocus:"",placeholder:"Search...",class:"search-input",required:""},null,512),[[T,e.keywordLocal]])]),s("div",z,[s("div",O,[G,d("  "),h(s("select",{name:"order","onUpdate:modelValue":o[1]||(o[1]=a=>e.orderByLocal=a),class:"param-select"},Q,512),[[p,e.orderByLocal]])]),s("div",W,[X,d("  "),h(s("select",{name:"maxResults","onUpdate:modelValue":o[2]||(o[2]=a=>e.maxResultsLocal=a),class:"param-select"},te,512),[[p,e.maxResultsLocal]])]),s("div",se,[ae,d("  "),h(s("select",{name:"searchIn","onUpdate:modelValue":o[3]||(o[3]=a=>e.searchInLocal=a),class:"param-select"},ie,512),[[p,e.searchInLocal]])]),s("div",ne,[le,d("  "),h(s("select",{name:"showResults","onUpdate:modelValue":o[4]||(o[4]=a=>e.showResultsLocal=a),class:"param-select"},de,512),[[p,e.showResultsLocal]])])])]))}});const me=N(he,[["__scopeId","data-v-c9f6801e"]]),ge=t=>(C("data-v-468756b9"),t=t(),B(),t),pe={key:0},_e={class:"book-content-wrap"},ve={class:"thumbnail-wrap"},ke=["src"],Pe={key:1,class:"book-thumbnail-no-pic"},fe={class:"info-wrap"},be={class:"title"},we={key:0,class:"info-description"},ye={key:1,class:"info-description-no-desc"},Ie={class:"info-footer"},Se={key:1},$e=ge(()=>s("div",{class:"book-content-wrap skeleton-mobile"},[s("div",{class:"thumbnail-wrap"},[s("div",{class:"book-thumbnail skeleton"}," ")]),s("div",{class:"info-wrap skeleton"},"   ")],-1)),Re=[$e],Le={key:2,class:"end-of-list"},Ce={key:3,class:"no-found"},Be={key:4,class:"error"},Ne={name:"BookSearchList",template:"#dookSearchList"},Ve=g({...Ne,props:{books:{},loadState:{},totalItems:{},showResults:{},isHasNextPage:{type:Boolean}},setup(t){return(e,o)=>{const a=E("RouterLink");return i(),n(m,null,[(e.loadState==="success"&&e.showResults==="page"||e.showResults==="scroll")&&e.books&&e.books.length>0?(i(),n("ul",pe,[(i(!0),n(m,null,_(e.books,l=>{var k,P,f,b,w,y,I,S;return i(),n("li",{key:l.id},[s("div",_e,[s("div",ve,[(P=(k=l.volumeInfo)==null?void 0:k.imageLinks)!=null&&P.thumbnail?(i(),n("img",{key:0,class:"book-thumbnail",src:(b=(f=l.volumeInfo)==null?void 0:f.imageLinks)==null?void 0:b.thumbnail},null,8,ke)):(i(),n("div",Pe,"no picture"))]),s("div",fe,[s("h3",be,[u(a,{to:{name:"book",params:{bookId:l.id}},class:"title-link"},{default:L(()=>{var $;return[d(v(($=l.volumeInfo)==null?void 0:$.title),1)]}),_:2},1032,["to"])]),(w=l.volumeInfo)!=null&&w.description?(i(),n("p",we,v((y=l.volumeInfo)==null?void 0:y.description),1)):(i(),n("p",ye,"no description")),s("div",Ie,[u(R,{field:{title:"Published",value:(I=l==null?void 0:l.volumeInfo)==null?void 0:I.publishedDate}},null,8,["field"]),u(R,{field:{title:"Language",value:(S=l==null?void 0:l.volumeInfo)==null?void 0:S.language}},null,8,["field"]),u(a,{to:{name:"book",params:{bookId:l.id}},class:"info-show-details-link"},{default:L(()=>[d(" Show details ")]),_:2},1032,["to"])])])])])}),128))])):c("",!0),e.loadState==="loading"?(i(),n("ul",Se,[(i(!0),n(m,null,_(Array(12).fill(0),l=>(i(),n("li",{key:l},Re))),128))])):c("",!0),e.showResults==="scroll"&&e.loadState==="success"&&e.isHasNextPage===!1?(i(),n("div",Le," End of list ")):c("",!0),e.loadState==="success"&&e.totalItems===void 0?(i(),n("div",Ce," No results found ")):c("",!0),e.loadState==="error"?(i(),n("div",Be," Error ")):c("",!0)],64)}}});const He=N(Ve,[["__scopeId","data-v-468756b9"]]),Fe={class:"pagination"},Te={class:"pagination-item"},De=["disabled"],Ee={class:"pagination-item"},Me=["disabled"],Ue=["onClick","disabled"],je={class:"pagination-item"},Ae=["disabled"],qe={class:"pagination-item"},ze=["disabled"],Oe={name:"BookSearchPagination",template:"#bookSearchPagination",data(){return{maxVisibleButtons:10}},computed:{startPage(){return this.currentPage===1?1:this.currentPage===this.totalPages?this.totalPages-this.maxVisibleButtons+1:this.currentPage-1},endPage(){return Math.min(this.startPage+this.maxVisibleButtons-1,this.totalPages)},pages(){const t=[];for(let e=this.startPage;e<=this.endPage;e+=1)t.push({name:e,isDisabled:e===this.currentPage});return t},isInFirstPage(){return this.currentPage===1},isInLastPage(){return this.currentPage===this.totalPages}},methods:{onClickFirstPage(){this.$emit("pagechanged",1)},onClickPreviousPage(){this.$emit("pagechanged",this.currentPage-1)},onClickPage(t){this.$emit("pagechanged",t)},onClickNextPage(){this.$emit("pagechanged",this.currentPage+1)},onClickLastPage(){this.$emit("pagechanged",this.totalPages)},isPageActive(t){return this.currentPage===t}}},Ge=g({...Oe,props:{totalPages:{},currentPage:{}},setup(t){return(e,o)=>(i(),n("ul",Fe,[s("li",Te,[s("button",{type:"button",onClick:o[0]||(o[0]=(...a)=>e.onClickFirstPage&&e.onClickFirstPage(...a)),disabled:e.isInFirstPage}," First ",8,De)]),s("li",Ee,[s("button",{type:"button",onClick:o[1]||(o[1]=(...a)=>e.onClickPreviousPage&&e.onClickPreviousPage(...a)),disabled:e.isInFirstPage}," Previous ",8,Me)]),(i(!0),n(m,null,_(e.pages,a=>(i(),n("li",{key:a.name,class:"pagination-item"},[s("button",{type:"button",onClick:l=>e.onClickPage(a.name),disabled:a.isDisabled,class:M({active:e.isPageActive(a.name)})},v(a.name),11,Ue)]))),128)),s("li",je,[s("button",{type:"button",onClick:o[2]||(o[2]=(...a)=>e.onClickNextPage&&e.onClickNextPage(...a)),disabled:e.isInLastPage}," Next ",8,Ae)]),s("li",qe,[s("button",{type:"button",onClick:o[3]||(o[3]=(...a)=>e.onClickLastPage&&e.onClickLastPage(...a)),disabled:e.isInLastPage}," Last ",8,ze)])]))}});const H=U(null),Je={name:"BookSearch",data(){return{currentPage:1,books:[],keyword:"",orderBy:"relevance",searchIn:"intitle",showResults:"page",maxResults:10,loadState:"",totalItems:void 0,totalPages:void 0,isHasNextPage:!0}},watch:{keyword:j(function(){this.loadState="loading",this.search()},500)},mounted(){window.addEventListener("scroll",this.handleScroll)},unmounted(){window.removeEventListener("scroll",this.handleScroll)},methods:{handleScroll(){if(this.loadState==="loading"||this.showResults==="page")return;const t=H.value;t&&t.getBoundingClientRect().bottom<window.innerHeight+600&&(this.isHasNextPage=this.maxResults*this.currentPage<=this.totalItems,this.isHasNextPage&&(this.currentPage++,this.search()))},onPageChange(t){this.currentPage=t,this.search(),window.scrollTo(0,0)},onSearchParamChange(t,e){this[t]=e,this.currentPage=1,this.isHasNextPage=!0,t!=="keyword"&&(this.books=[],this.search()),t==="keyword"&&this.showResults==="scroll"&&(this.books=[]),window.scrollTo(0,0)},search(){if(this.keyword.trim()===""){this.loadState="";return}this.loadState="loading",F(this.searchIn===""?this.keyword:`${this.searchIn}:${this.keyword}`,this.maxResults,this.orderBy,(this.currentPage-1)*this.maxResults).then(t=>{this.showResults==="scroll"?this.books.push(...(t==null?void 0:t.items)||[]):this.books=(t==null?void 0:t.items)||[],this.totalItems=t!=null&&t.totalItems?t.totalItems:void 0,this.totalPages=t!=null&&t.totalItems?Math.ceil(t.totalItems/this.maxResults):void 0,this.loadState="success"}).catch(t=>{console.log(t),this.books=void 0,this.totalItems=void 0,this.totalPages=void 0,this.loadState="error"})}}},Ke=g({...Je,setup(t){return(e,o)=>(i(),n(m,null,[u(me,{keyword:e.keyword,orderBy:e.orderBy,searchIn:e.searchIn,showResults:e.showResults,maxResults:e.maxResults,onSearchparamchange:e.onSearchParamChange},null,8,["keyword","orderBy","searchIn","showResults","maxResults","onSearchparamchange"]),s("div",{class:"scrolling-component",id:"theList",ref_key:"scrollComponent",ref:H},[u(He,{books:e.books,loadState:e.loadState,totalItems:e.totalItems,showResults:e.showResults,isHasNextPage:e.isHasNextPage},null,8,["books","loadState","totalItems","showResults","isHasNextPage"])],512),e.showResults==="page"&&e.loadState==="success"&&e.books.length>e.maxResults-1&&e.totalItems&&e.totalPages&&e.totalItems>0?(i(),V(Ge,{key:0,totalPages:e.totalPages,currentPage:e.currentPage,onPagechanged:e.onPageChange},null,8,["totalPages","currentPage","onPagechanged"])):c("",!0)],64))}}),Xe=g({__name:"HomeView",setup(t){return(e,o)=>(i(),V(Ke))}});export{Xe as default};
